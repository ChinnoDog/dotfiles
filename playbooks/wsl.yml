---
- name: Configure WSL2 environment
  hosts: localhost
  connection: local
  become: true
  vars:
    vagrant_enable_var: 'export VAGRANT_WSL_ENABLE_WINDOWS_ACCESS="1"'
  roles:
  - role: common
  post_tasks:

  - name: Enable Vagrant to work in WSL
    lineinfile:
      path: ~/.bashrc
      regexp: "^{{ vagrant_enable_var.split('=')[0] }}="
      line: "{{ vagrant_enable_var }}"
   
  - name: Add Microsoft key
    get_url:
      url: https://packages.microsoft.com/keys/microsoft.asc 
      dest: /etc/apt/trusted.gpg.d/microsoft.asc

  - name: Add Azure-cli PPA
    apt_repository:
      repo: "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ {{ansible_distribution_release}} main"
      filename: azure-cli

  - name: Install packages
    apt:
      install_recommends: true
      update_cache: true
      name:
      - azure-cli

- name: Configure WSL2 user profile
  hosts: localhost
  connection: local
  become: false
  tasks:

  - name: git common settings
    git_config:
      scope: global
      name: "{{ (item|dict2items)[0].key }}"
      value: "{{ (item|dict2items)[0].value }}"
    loop:
    - user.email: snichols@nasuni.com

